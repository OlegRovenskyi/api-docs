
# Описание Kuna API v2

Давным-давно. Когда Bitcoin стоил $600, а инфобизнесмены ходили в школу. Когда Виталик только мечтал о своем проекте, а криптовалюта для масс была лишь странной религией. Был запущен краудфандинг на создание биржи в Украине, и собрал краудфайндин в 2.7 раза больше необходимого, и была рождена биржа Kuna. Биржа не была идеальной и на ней была лишь одна пара _BTC/UAH_, но она стала глотком свежего воздуха для всего криптосообщества Украины. Через биржу можно было с легкостью купить и продать криптовалюту в Украине. Никаких сложных форм KYC. Лишь кнопки Buy и Sell и стакан между ними. И это было прекрасно.

Уже тогда, что бы на биржу завести робота, который самостоятельно "нажимает" на Buy и Sell, было разработано **Kuna API v2** - простой и понятный интерфейс для програмной работы с биржей. Эта документация все еще актуальна, но мы советуем переходить на [API v3](https://github.com/kunadevelopers/api-docs), так как API v2 скоро погибнет.

Добро пожаловать, в этот замысловатый мир технических терминов!


## Оглавление

* [Публичные методы](#публичные-методы)
  * [Время на сервере биржи](#время-на-сервере-биржи)
  * [Последние данные по рынку](#последние-данные-по-рынку)
  * [Биржевой стакан](#биржевой-стакан)
  * [История торгов](#история-торгов)

* [Пользовательские методы](#пользовательские-методы)
  * [Информация о пользователе и активах](#информация-о-пользователе-и-активах)
  * [Выставление ордера](#выставление-ордера)
  * [Отмена ордера](#отмена-ордера)
  * [Активные ордера пользователя](#активные-ордера-пользователя)
  * [История сделок пользователя](#история-сделок-пользователя)


## Публичные методы

### Время на сервере биржи

[https://kuna.io/api/v2/timestamp](https://kuna.io/api/v2/timestamp)

```bash
1465845534 — временная метка в юникс-формате
```


### Последние данные по рынку

[https://kuna.io/api/v2/tickers/btcuah](https://kuna.io/api/v2/tickers/btcuah)

```bash
{
    "at": время на сервере,
    "ticker": {
        "buy": цена биткоина на покупку,
        "sell": цена биткоина на продажу,
        "low": наименьшая цена сделки за 24 часа,
        "high": наибольшая цена сделки за 24 часа,
        "last": цена последней сделки,
        "vol": объём торгов в базовой валюте за 24 часа,
        "amount": общая стоимость торгов в котируемое валюте за 24 часа
    }
}
```


### Биржевой стакан

[https://kuna.io/api/v2/depth?market=btcuah](https://kuna.io/api/v2/depth?market=btcuah)

```bash
{
    "timestamp": временная метка
    "asks": массив ордеров на продажу
    [
        [цена, объём]
    ],
    "bids": массив ордеров на покупку
    [
        [цена, объём]
    ]
}
```


### История торгов

[https://kuna.io/api/v2/trades?market=btcuah](https://kuna.io/api/v2/trades?market=btcuah)

```bash
[{
    "id": идентификатор сделки,
    "price": цена за биткоин,
    "volume": объём в биткоинах,
    "funds": объём в гривнах,
    "market": идентификатор рынка,
    "created_at": время сделки,
    "side": всегда null
}]
```


## Пользовательские методы
  
Используются для получения пользовательской информации и для торгов. Для использования необходим API-токен, который можно [создать в кабинете](https://kuna.io/api_tokens/new).

Все пользовательские запросы должны содержать параметры `access_key`, `tonce` и `signature`.  
Например: [https://kuna.io/api/v2/members/me?access_key=dV6vEJe1CO&tonce=1465850766246&signature=secret](https://kuna.io/api/v2/members/me?access_key=dV6vEJe1CO&tonce=1465850766246&signature=secret)

```bash
access_key — публичная часть API-токена, которая отображается в кабинете в разделе API
tonce — временная метка в юникс-формате с миллисекундами
signature — подпись
```

Подпись генерируется по алгоритму:
```bash
HEX(HMAC-SHA256("HTTP-verb|URI|params", secret_key))  
```


```bash
HTTP-verb — это GET или POST
URI — стока запроса без домена
params — отсортированные параметры, включая access_key и tonce, но без подписи
secret_key — секретная часть API-токена
```

Например, запрос для получения истории торгов пользователя:

```bash
HEX(
    HMAC-SHA256(
        "GET|/api/v2/trades/my|access_key=dV6vEJe1CO&market=btcuah&tonce=1465850766246",
        "AYifzxC3Xo"
    )
)
```

Результат выполнения этой функции:
```bash
33a694498a2a70cb4ca9a7e28224321e20b41f10217604e9de80ff4ee8cf310e — это и будет подписью для данного запроса
```


### Информация о пользователе и активах

[https://kuna.io/api/v2/members/me](https://kuna.io/api/v2/members/me)

```bash
{
    "email": электронная почта,
    "activated": активирован ли акаунт,
    "accounts": массив активов
    [{
        "currency": валюта,
        "balance": доступная сумма,
        "locked": заблокированная сумма
    }]
}
```


### Выставление ордера

POST [https://kuna.io/api/v2/orders](https://kuna.io/api/v2/orders)

**Параметры:**
```bash
side — buy или sell
volume — объём ордера в биткоинах
market — btcuah
price — цена за один биткоин
```

**Ответ:**
```bash
{
    "id": идентификатор ордера,
    "side": buy или sell,
    "ord_type": тип ордера — limit или market,
    "price": цена за биткоин,
    "avg_price": средняя цена сделки по ордеру, для нового ордера — 0,
    "state": состояние ордера, для нового ордера — wait,
    "market": идентификатор рынка,
    "created_at": время выставления ордера,
    "volume": выставленный объём в биткоинах,
    "remaining_volume": незаполненное количество биткоинов,
    "executed_volume": заполненное количество биткоинов, для нового ордера — 0,
    "trades_count": количество торгов по ордеру, для нового ордера — 0
}
```


### Отмена ордера

POST [https://kuna.io/api/v2/order/delete](https://kuna.io/api/v2/order/delete)

**Параметры:**
```bash
id — идентификатор ордера
```

**Ответ:**
```bash
{
    "id": идентификатор ордера,
    "side": buy или sell,
    "ord_type": тип ордера — limit или market,
    "price": цена за биткоин,
    "avg_price": средняя цена сделки по ордеру,
    "state": состояние ордера — весгда wait,
    "market": идентификатор рынка,
    "created_at": время выставления ордера,
    "volume": объём сделки в биткоинах,
    "remaining_volume": незаполненное количество биткоинов,
    "executed_volume": заполненное количество биткоинов,
    "trades_count": количество сделок по ордеру
}
```


### Активные ордера пользователя

GET [https://kuna.io/api/v2/orders](https://kuna.io/api/v2/orders)

**Параметры:**
```bash
market — btcuah
```

**Ответ:**
```bash
[{
    "id": идентификатор ордера,
    "side": buy или sell,
    "ord_type": тип ордера— limit или market,
    "price": цена за биткоин,
    "avg_price": средняя цена сделки по ордеру,
    "state": состояние ордера — всегда wait,
    "market": идентификатор рынка,
    "created_at": время выставления ордера,
    "volume": объём сделки в биткоинах,
    "remaining_volume": оставшееся количество биткоинов,
    "executed_volume": купленное количество биткоинов,
    "trades_count": количество сделок по ордеру
}]
```


### История сделок пользователя

GET [https://kuna.io/api/v2/trades/my](https://kuna.io/api/v2/trades/my)

**Параметры:**
```bash
market — btcuah
```

**Ответ:**
```bash
[{
    "id": идентификатор сделки,
    "price": цена за биткоин,
    "volume": объём в биткоинах,
    "funds": объём в гривнах,
    "market": идентификатор рынка,
    "created_at": время сделки,
    "side": bid или ask
}]
```
